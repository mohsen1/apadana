#!/usr/bin/env sh
. "$(dirname "$0")/_/husky.sh"

echo "Running prepare-commit-msg hook"

COMMIT_MSG_FILE="$1"
DIFF=$(git diff --cached)

SUMMARY=$(
  ollama run phi4 <<EOF
Generate a commit message for the following diff. Make the first line the title and the rest the body:
$DIFF
EOF
)

if [ -f "$COMMIT_MSG_FILE" ]; then
  EXISTING_MSG=$(cat "$COMMIT_MSG_FILE")
fi

cat <<EOF >"$COMMIT_MSG_FILE"
# AI-generated diff summary:
$SUMMARY

$EXISTING_MSG
EOF
